<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>const int FlexTaskGet_id = 0;
const int FlexTaskSend_id = 1;

int	inquiryResultsNum;

chan	taskActivation[2];
chan	InitTask[2];
chan	ActivateTask[2];
chan	hello, pcRescan, pcConnect;
chan	flexDataSend;
chan 	flexShowInquiryResults, flexConnected;
chan 	bluetoothInit, bluetoothInitFailed, bluetoothInitSuccess,
	bluetoothInquiry, bluetoothInquiryResults,
	initializeElm327, requestVehicleData, vehicleDataReady;
broadcast chan bufferNotEmpty;</declaration><template><name>FlexMain</name><location id="id0" x="-80" y="-80"><name x="-248" y="-88">WAIT_FOR_REQUEST</name></location><location id="id1" x="-80" y="312"></location><location id="id2" x="-80" y="-136"><name x="-208" y="-152">WAIT_FOR_PING</name></location><location id="id3" x="-80" y="432"></location><location id="id4" x="-80" y="352"></location><location id="id5" x="-80" y="392"></location><location id="id6" x="-80" y="120"></location><location id="id7" x="-80" y="-8"></location><location id="id8" x="-80" y="248"><name x="-192" y="232">BT_CONNECT</name></location><location id="id9" x="-80" y="184"><name x="-232" y="168">BT_INQUIRY_SHOW</name></location><location id="id10" x="-80" y="472"><name x="-176" y="464">MAIN_DEAD</name></location><location id="id11" x="-80" y="-264"><name x="-184" y="-280">MAIN_START</name></location><location id="id12" x="-80" y="56"><name x="-184" y="40">BT_INQUIRY</name></location><location id="id13" x="-80" y="-200"><name x="-152" y="-216">BT_INIT</name></location><init ref="id11"/><transition><source ref="id0"/><target ref="id7"/><label kind="synchronisation" x="-160" y="-56">pcRescan?</label></transition><transition><source ref="id1"/><target ref="id4"/><label kind="synchronisation" x="-256" y="320">InitTask[FlexTaskGet_id]!</label></transition><transition><source ref="id2"/><target ref="id0"/><label kind="synchronisation" x="-120" y="-120">hello!</label></transition><transition><source ref="id5"/><target ref="id3"/><label kind="synchronisation" x="-264" y="400">InitTask[FlexTaskSend_id]!</label></transition><transition><source ref="id3"/><target ref="id10"/><label kind="synchronisation" x="-296" y="440">ActivateTask[FlexTaskSend_id]!</label></transition><transition><source ref="id4"/><target ref="id5"/><label kind="synchronisation" x="-288" y="360">ActivateTask[FlexTaskGet_id]!</label></transition><transition><source ref="id8"/><target ref="id1"/><label kind="synchronisation" x="-184" y="272">flexConnected!</label></transition><transition><source ref="id6"/><target ref="id9"/><label kind="synchronisation" x="-240" y="136">flexShowInquiryResults!</label></transition><transition><source ref="id9"/><target ref="id7"/><label kind="synchronisation" x="-56" y="160">pcRescan?</label><nail x="152" y="184"/><nail x="152" y="-32"/><nail x="-40" y="-32"/></transition><transition><source ref="id9"/><target ref="id8"/><label kind="synchronisation" x="-176" y="200">pcConnect?</label></transition><transition><source ref="id12"/><target ref="id6"/><label kind="guard" x="-240" y="72">inquiryResultsNum &gt; 0</label><label kind="synchronisation" x="-240" y="88">bluetoothInquiryResults?</label></transition><transition><source ref="id12"/><target ref="id7"/><label kind="guard" x="-16" y="8">inquiryResultsNum == 0</label><label kind="synchronisation" x="-16" y="24">bluetoothInquiryResults?</label><nail x="-24" y="56"/><nail x="-24" y="-8"/></transition><transition><source ref="id7"/><target ref="id12"/><label kind="synchronisation" x="-192" y="8">bluetoothInquiry!</label></transition><transition><source ref="id11"/><target ref="id13"/><label kind="synchronisation" x="-168" y="-240">bluetoothInit!</label></transition><transition><source ref="id13"/><target ref="id10"/><label kind="synchronisation" x="-64" y="-224">bluetoothInitFailed?</label><nail x="64" y="-200"/><nail x="160" y="-40"/><nail x="160" y="192"/></transition><transition><source ref="id13"/><target ref="id2"/><label kind="synchronisation" x="-224" y="-176">bluetoothInitSuccess?</label></transition></template><template><name>Bluetooth</name><location id="id14" x="136" y="72"><name x="72" y="80">ACQUIRING_DATA</name></location><location id="id15" x="-40" y="168"><committed/></location><location id="id16" x="-40" y="136"></location><location id="id17" x="-128" y="24"></location><location id="id18" x="-40" y="24"></location><location id="id19" x="-40" y="-48"><name x="-64" y="-80">START</name></location><init ref="id19"/><transition><source ref="id18"/><target ref="id18"/><label kind="synchronisation" x="-240" y="-64">initializeElm327?</label><nail x="-128" y="-32"/><nail x="-128" y="-80"/></transition><transition><source ref="id18"/><target ref="id14"/><label kind="synchronisation" x="-16" y="48">requestVehicleData?</label><nail x="-16" y="72"/></transition><transition><source ref="id14"/><target ref="id18"/><label kind="synchronisation" x="-8" y="0">vehicleDataReady!</label><nail x="136" y="24"/></transition><transition><source ref="id16"/><target ref="id15"/><label kind="assignment" x="-216" y="144">inquiryResultsNum = 0</label><nail x="-72" y="136"/><nail x="-72" y="168"/></transition><transition><source ref="id15"/><target ref="id18"/><label kind="synchronisation" x="-200" y="200">bluetoothInquiryResults!</label><nail x="-40" y="224"/><nail x="-224" y="224"/><nail x="-224" y="136"/></transition><transition><source ref="id16"/><target ref="id15"/><label kind="assignment" x="0" y="144">inquiryResultsNum = 3</label><nail x="-8" y="136"/><nail x="-8" y="168"/></transition><transition><source ref="id18"/><target ref="id16"/><label kind="synchronisation" x="-32" y="96">bluetoothInquiry?</label></transition><transition><source ref="id17"/><target ref="id18"/><label kind="synchronisation" x="-264" y="40">bluetoothInitSuccess!</label><nail x="-128" y="56"/></transition><transition><source ref="id18"/><target ref="id17"/><label kind="synchronisation" x="-216" y="-16">bluetoothInit?</label><nail x="-128" y="-16"/></transition><transition><source ref="id19"/><target ref="id18"/></transition></template><template><name>FlexSendData</name><location id="id20" x="0" y="168"><name x="-48" y="184">SEND_START</name></location><location id="id21" x="-216" y="168"></location><location id="id22" x="0" y="-24"><name x="-192" y="-32">WAIT_FOR_BUFFER_FULL</name></location><location id="id23" x="0" y="120"><name x="-192" y="112">RELEASE_DATA_BUFFER</name><committed/></location><location id="id24" x="0" y="80"><name x="-120" y="72">READ_BUFFER</name><committed/></location><location id="id25" x="0" y="40"><name x="-192" y="32">ACQUIRE_DATA_BUFFER</name></location><location id="id26" x="0" y="-88"></location><init ref="id21"/><transition><source ref="id23"/><target ref="id20"/></transition><transition><source ref="id21"/><target ref="id20"/><label kind="synchronisation" x="-200" y="144">InitTask[FlexTaskSend_id]?</label></transition><transition><source ref="id22"/><target ref="id25"/><label kind="synchronisation" x="-112" y="-8">bufferNotEmpty?</label></transition><transition><source ref="id24"/><target ref="id23"/></transition><transition><source ref="id25"/><target ref="id24"/></transition><transition><source ref="id20"/><target ref="id26"/><label kind="synchronisation" x="48" y="0">flexDataSend!</label><nail x="40" y="128"/><nail x="40" y="-56"/></transition><transition><source ref="id26"/><target ref="id22"/><label kind="synchronisation" x="-216" y="-72">taskActivation[FlexTaskSend_id]?</label></transition></template><template><name>FlexGetData</name><location id="id27" x="0" y="224"></location><location id="id28" x="0" y="-160"></location><location id="id29" x="0" y="-112"><name x="-104" y="-128">ELM327_INIT</name></location><location id="id30" x="0" y="184"><name x="-192" y="176">RELEASE_DATA_BUFFER</name><committed/></location><location id="id31" x="0" y="104"><name x="-192" y="96">ACQUIRE_DATA_BUFFER</name></location><location id="id32" x="0" y="144"><name x="-128" y="136">WRITE_BUFFER</name><committed/></location><location id="id33" x="0" y="48"></location><location id="id34" x="0" y="-64"><name x="-104" y="-72">GET_START</name></location><location id="id35" x="0" y="0"><name x="-184" y="-8">OBTAIN_VEHICLE_DATA</name></location><init ref="id28"/><transition><source ref="id30"/><target ref="id27"/></transition><transition><source ref="id28"/><target ref="id29"/><label kind="synchronisation" x="-176" y="-152">InitTask[FlexTaskGet_id]?</label></transition><transition><source ref="id29"/><target ref="id34"/><label kind="synchronisation" x="-112" y="-96">initializeElm327!</label></transition><transition><source ref="id32"/><target ref="id30"/></transition><transition><source ref="id31"/><target ref="id32"/></transition><transition><source ref="id27"/><target ref="id34"/><label kind="synchronisation" x="48" y="80">bufferNotEmpty!</label><nail x="40" y="184"/><nail x="40" y="-32"/></transition><transition><source ref="id35"/><target ref="id33"/><label kind="synchronisation" x="-136" y="16">requestVehicleData!</label></transition><transition><source ref="id33"/><target ref="id31"/><label kind="synchronisation" x="-128" y="64">vehicleDataReady?</label></transition><transition><source ref="id34"/><target ref="id35"/><label kind="synchronisation" x="-208" y="-48">taskActivation[FlexTaskGet_id]?</label></transition></template><template><name>Scheduler</name><declaration>bool FlexTaskSendON, FlexTaskGetON;</declaration><location id="id36" x="0" y="-120"></location><location id="id37" x="0" y="0"></location><init ref="id36"/><transition><source ref="id37"/><target ref="id37"/><label kind="synchronisation" x="-272" y="8">ActivateTask[FlexTaskSend_id]?</label><label kind="assignment" x="-224" y="24">FlexTaskSendON = true</label><nail x="-64" y="8"/><nail x="-64" y="64"/></transition><transition><source ref="id37"/><target ref="id37"/><label kind="synchronisation" x="-264" y="-48">ActivateTask[FlexTaskGet_id]?</label><label kind="assignment" x="-216" y="-32">FlexTaskGetON = true</label><nail x="-64" y="-64"/><nail x="-64" y="-8"/></transition><transition><source ref="id36"/><target ref="id37"/><label kind="assignment" x="8" y="-104">FlexTaskGetON = false,
FlexTaskSendON = false</label></transition><transition><source ref="id37"/><target ref="id37"/><label kind="guard" x="72" y="8">FlexTaskSendON</label><label kind="synchronisation" x="72" y="24">taskActivation[FlexTaskSend_id]!</label><nail x="64" y="8"/><nail x="64" y="64"/></transition><transition><source ref="id37"/><target ref="id37"/><label kind="guard" x="72" y="-48">FlexTaskGetON</label><label kind="synchronisation" x="72" y="-32">taskActivation[FlexTaskGet_id]!</label><nail x="64" y="-64"/><nail x="64" y="-8"/></transition></template><template><name>PC</name><location id="id38" x="-32" y="-184"></location><location id="id39" x="-32" y="-120"></location><location id="id40" x="-32" y="88"><name x="-136" y="72">DATA_LOOP</name></location><location id="id41" x="-32" y="24"><name x="-120" y="8">CONNECT</name></location><location id="id42" x="-32" y="-48"><name x="-152" y="-64">INQUIRY_REQ</name></location><location id="id43" x="-32" y="-240"><name x="-184" y="-248">BRIDGE_CONNECT</name></location><init ref="id43"/><transition><source ref="id38"/><target ref="id39"/><label kind="synchronisation" x="-112" y="-168">pcRescan!</label></transition><transition><source ref="id42"/><target ref="id39"/><label kind="synchronisation" x="-16" y="-72">pcRescan!</label><nail x="64" y="-48"/><nail x="64" y="-120"/></transition><transition><source ref="id39"/><target ref="id42"/><label kind="synchronisation" x="-192" y="-96">flexShowInquiryResults?</label></transition><transition><source ref="id43"/><target ref="id43"/><nail x="0" y="-208"/><nail x="0" y="-272"/></transition><transition><source ref="id40"/><target ref="id40"/><label kind="synchronisation" x="-128" y="104">flexDataSend?</label><nail x="-32" y="136"/><nail x="16" y="136"/></transition><transition><source ref="id41"/><target ref="id40"/><label kind="synchronisation" x="-136" y="48">flexConnected?</label></transition><transition><source ref="id42"/><target ref="id41"/><label kind="synchronisation" x="-112" y="-24">pcConnect!</label></transition><transition><source ref="id43"/><target ref="id38"/><label kind="synchronisation" x="-80" y="-224">hello?</label></transition></template><system>system PC, FlexMain, FlexGetData, FlexSendData, Bluetooth, Scheduler;</system></nta>